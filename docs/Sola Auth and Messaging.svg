<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2003px" preserveAspectRatio="none" style="width:1220px;height:2003px;background:#FFFFFF;" version="1.1" viewBox="0 0 1220 2003" width="1220px" zoomAndPan="magnify"><title>Sola &#8212; Auth &amp; Messaging Sequence</title><defs/><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="439.3125" x="389.1504" y="37.1182">Sola &#8212; Auth &amp; Messaging Sequence</text><rect fill="#FFFFFF" height="544.0923" style="stroke:#000000;stroke-width:1;" width="628.0859" x="15" y="281.9639"/><rect fill="#FFFFFF" height="194.9639" style="stroke:none;stroke-width:1;" width="628.0859" x="15" y="479.3584"/><rect fill="#FFFFFF" height="90.7666" style="stroke:none;stroke-width:1;" width="628.0859" x="15" y="674.3223"/><rect fill="#FFFFFF" height="60.9673" style="stroke:none;stroke-width:1;" width="628.0859" x="15" y="765.0889"/><rect fill="#FFFFFF" height="154.5952" style="stroke:#000000;stroke-width:1;" width="787.812" x="15" y="1032.6514"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="User" id="part1-lifeline"><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="39.9277" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="43" x2="43" y1="132.7666" y2="1907.8281"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="App" id="part2-lifeline"><g><title>React Native</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="231.4614" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="234.9219" x2="234.9219" y1="132.7666" y2="1907.8281"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="OAuth" id="part3-lifeline"><g><title>lib.oauth.ts</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="391.0386" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="394.6348" x2="394.6348" y1="132.7666" y2="1907.8281"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Auth" id="part4-lifeline"><g><title>Supabase</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="577.9233" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="581.7607" x2="581.7607" y1="132.7666" y2="1907.8281"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="DB" id="part5-lifeline"><g><title>Postgres</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="755.7715" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="759.731" x2="759.731" y1="132.7666" y2="1907.8281"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="Edge" id="part6-lifeline"><g><title>Edge Function</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="953.771" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="956.8599" x2="956.8599" y1="132.7666" y2="1907.8281"/></g></g><g class="participant-lifeline" data-entity-uid="part7" data-qualified-name="Push" id="part7-lifeline"><g><title>Expo Push</title><rect fill="#000000" fill-opacity="0.00000" height="1775.0615" width="8" x="1151.2461" y="132.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1154.8789" x2="1154.8789" y1="132.7666" y2="1907.8281"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="User" id="part1-head"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="31.8555" x="25" y="129.8271">User</text><ellipse cx="43.9277" cy="63.752" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M43.9277,71.752 L43.9277,98.752 M30.9277,79.752 L56.9277,79.752 M43.9277,98.752 L30.9277,113.752 M43.9277,98.752 L56.9277,113.752" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="User" id="part1-tail"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="31.8555" x="25" y="1920.9033">User</text><ellipse cx="43.9277" cy="1932.8428" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M43.9277,1940.8428 L43.9277,1967.8428 M30.9277,1948.8428 L56.9277,1948.8428 M43.9277,1967.8428 L30.9277,1982.8428 M43.9277,1967.8428 L56.9277,1982.8428" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="App" id="part2-head"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="103.0791" x="183.9219" y="83.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89.0791" x="190.9219" y="104.8125">React Native</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="27.0156" x="221.9536" y="121.8271">App</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="App" id="part2-tail"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="103.0791" x="183.9219" y="1906.8281"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89.0791" x="190.9219" y="1927.9033">React Native</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="27.0156" x="221.9536" y="1944.918">App</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="OAuth" id="part3-head"><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="94.8076" x="347.6348" y="100.752"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80.8076" x="354.6348" y="121.8271">lib/oauth.ts</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="OAuth" id="part3-tail"><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="94.8076" x="347.6348" y="1906.8281"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80.8076" x="354.6348" y="1927.9033">lib/oauth.ts</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Auth" id="part4-head"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="82.3252" x="540.7607" y="83.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="68.3252" x="547.7607" y="104.8125">Supabase</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="32.8057" x="565.5205" y="121.8271">Auth</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Auth" id="part4-tail"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="82.3252" x="540.7607" y="1906.8281"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="68.3252" x="547.7607" y="1927.9033">Supabase</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="32.8057" x="565.5205" y="1944.918">Auth</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="DB" id="part5-head"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="60.0811" x="726.731" y="112.8125">Postgres</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="39.8125" x="736.8652" y="129.8271">(RLS)</text><path d="M741.7715,62.7373 C741.7715,52.7373 759.7715,52.7373 759.7715,52.7373 C759.7715,52.7373 777.7715,52.7373 777.7715,62.7373 L777.7715,88.7373 C777.7715,98.7373 759.7715,98.7373 759.7715,98.7373 C759.7715,98.7373 741.7715,98.7373 741.7715,88.7373 L741.7715,62.7373" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M741.7715,62.7373 C741.7715,72.7373 759.7715,72.7373 759.7715,72.7373 C759.7715,72.7373 777.7715,72.7373 777.7715,62.7373" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="DB" id="part5-tail"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="60.0811" x="726.731" y="1920.9033">Postgres</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="39.8125" x="736.8652" y="1937.918">(RLS)</text><path d="M741.7715,1950.8574 C741.7715,1940.8574 759.7715,1940.8574 759.7715,1940.8574 C759.7715,1940.8574 777.7715,1940.8574 777.7715,1950.8574 L777.7715,1976.8574 C777.7715,1986.8574 759.7715,1986.8574 759.7715,1986.8574 C759.7715,1986.8574 741.7715,1986.8574 741.7715,1976.8574 L741.7715,1950.8574" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M741.7715,1950.8574 C741.7715,1960.8574 759.7715,1960.8574 759.7715,1960.8574 C759.7715,1960.8574 777.7715,1960.8574 777.7715,1950.8574" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="Edge" id="part6-head"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="139.8223" x="887.8599" y="83.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99.333" x="908.1045" y="104.8125">Edge Function</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="125.8223" x="894.8599" y="121.8271">push-on-message</text></g><g class="participant participant-tail" data-entity-uid="part6" data-qualified-name="Edge" id="part6-tail"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="139.8223" x="887.8599" y="1906.8281"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99.333" x="908.1045" y="1927.9033">Edge Function</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="125.8223" x="894.8599" y="1944.918">push-on-message</text></g><g class="participant participant-head" data-entity-uid="part7" data-qualified-name="Push" id="part7-head"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="86.7344" x="1111.8789" y="83.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72.7344" x="1118.8789" y="104.8125">Expo Push</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="23.9053" x="1143.2935" y="121.8271">API</text></g><g class="participant participant-tail" data-entity-uid="part7" data-qualified-name="Push" id="part7-tail"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="86.7344" x="1111.8789" y="1906.8281"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72.7344" x="1118.8789" y="1927.9033">Expo Push</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="23.9053" x="1143.2935" y="1944.918">API</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1208.6133" x="5" y="163.6663"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1213.6133" y1="163.6663" y2="163.6663"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1213.6133" y1="166.6663" y2="166.6663"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="145.2441" x="536.6846" y="152.7666"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126.8008" x="542.6846" y="169.8364">Sign Up / Sign In</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="223.4614,204.3652,233.4614,208.3652,223.4614,212.3652,227.4614,208.3652" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="208.3652" y2="208.3652"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62.8799" x="50.9277" y="203.6357">Open app</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="277.4614" y1="253.9639" y2="253.9639"/><line style="stroke:#000000;stroke-width:1;" x1="277.4614" x2="277.4614" y1="253.9639" y2="266.9639"/><line style="stroke:#000000;stroke-width:1;" x1="236.4614" x2="277.4614" y1="266.9639" y2="266.9639"/><polygon fill="#000000" points="246.4614,262.9639,236.4614,266.9639,246.4614,270.9639,242.4614,266.9639" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133.5356" x="242.4614" y="233.4351">Check AsyncStorage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113.0137" x="242.4614" y="249.2344">for saved session</text></g><path d="M15,281.9639 L79.0493,281.9639 L79.0493,289.7632 L69.0493,299.7632 L15,299.7632 L15,281.9639" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="544.0923" style="stroke:#000000;stroke-width:1;" width="628.0859" x="15" y="281.9639"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.0493" x="30" y="296.0337">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="182.2466" x="94.0493" y="295.0229">[No session &#8212; Google OAuth]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg3"><polygon fill="#000000" points="223.4614,317.5625,233.4614,321.5625,223.4614,325.5625,227.4614,321.5625" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="321.5625" y2="321.5625"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.5337" x="50.9277" y="316.833">Tap "Sign in with Google"</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg4"><polygon fill="#000000" points="383.0386,347.3618,393.0386,351.3618,383.0386,355.3618,387.0386,351.3618" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="389.0386" y1="351.3618" y2="351.3618"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97.5762" x="242.4614" y="346.6323">googleSignIn()</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg5"><line style="stroke:#000000;stroke-width:1;" x1="395.0386" x2="437.0386" y1="396.9604" y2="396.9604"/><line style="stroke:#000000;stroke-width:1;" x1="437.0386" x2="437.0386" y1="396.9604" y2="409.9604"/><line style="stroke:#000000;stroke-width:1;" x1="396.0386" x2="437.0386" y1="409.9604" y2="409.9604"/><polygon fill="#000000" points="406.0386,405.9604,396.0386,409.9604,406.0386,413.9604,402.0386,409.9604" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.7461" x="402.0386" y="376.4316">GoogleSignin.signIn()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="76.7686" x="402.0386" y="392.231">get idToken</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg6"><polygon fill="#000000" points="569.9233,467.3584,579.9233,471.3584,569.9233,475.3584,573.9233,471.3584" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="395.0386" x2="575.9233" y1="471.3584" y2="471.3584"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="129.1748" x="402.0386" y="435.0303">signInWithIdToken(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112.6836" x="411.1792" y="450.8296">provider: google,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.2856" x="411.1792" y="466.6289">token: idToken)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="15" x2="643.0859" y1="480.3584" y2="480.3584"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174.4531" x="20" y="491.4175">[No session &#8212; Apple OAuth]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg7"><polygon fill="#000000" points="223.4614,512.5264,233.4614,516.5264,223.4614,520.5264,227.4614,516.5264" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="516.5264" y2="516.5264"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="158.6597" x="50.9277" y="511.7969">Tap "Sign in with Apple"</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg8"><polygon fill="#000000" points="383.0386,542.3257,393.0386,546.3257,383.0386,550.3257,387.0386,546.3257" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="389.0386" y1="546.3257" y2="546.3257"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89.6035" x="242.4614" y="541.5962">appleSignIn()</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg9"><line style="stroke:#000000;stroke-width:1;" x1="395.0386" x2="437.0386" y1="591.9243" y2="591.9243"/><line style="stroke:#000000;stroke-width:1;" x1="437.0386" x2="437.0386" y1="591.9243" y2="604.9243"/><line style="stroke:#000000;stroke-width:1;" x1="396.0386" x2="437.0386" y1="604.9243" y2="604.9243"/><polygon fill="#000000" points="406.0386,600.9243,396.0386,604.9243,406.0386,608.9243,402.0386,604.9243" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="162.1128" x="402.0386" y="571.3955">AppleAuth.signInAsync()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="172.8848" x="402.0386" y="587.1948">get identityToken + nonce</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg10"><polygon fill="#000000" points="569.9233,662.3223,579.9233,666.3223,569.9233,670.3223,573.9233,666.3223" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="395.0386" x2="575.9233" y1="666.3223" y2="666.3223"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="129.1748" x="402.0386" y="629.9941">signInWithIdToken(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.7109" x="411.1792" y="645.7935">provider: apple,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="90.7397" x="411.1792" y="661.5928">token, nonce)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="15" x2="643.0859" y1="675.3223" y2="675.3223"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="131.1514" x="20" y="686.3813">[No session &#8212; Email]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#000000" points="223.4614,707.4902,233.4614,711.4902,223.4614,715.4902,227.4614,711.4902" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="711.4902" y2="711.4902"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.1714" x="50.9277" y="706.7607">Enter email + password</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg12"><polygon fill="#000000" points="569.9233,753.0889,579.9233,757.0889,569.9233,761.0889,573.9233,757.0889" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="575.9233" y1="757.0889" y2="757.0889"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="74.0962" x="242.4614" y="736.5601">signUp() or</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="143.311" x="242.4614" y="752.3594">signInWithPassword()</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="15" x2="643.0859" y1="766.0889" y2="766.0889"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84.8311" x="20" y="777.1479">[Has session]</text><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg13"><polygon fill="#000000" points="569.9233,814.0562,579.9233,818.0562,569.9233,822.0562,573.9233,818.0562" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="575.9233" y1="818.0562" y2="818.0562"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="82.6338" x="242.4614" y="797.5273">getSession()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="92.9106" x="242.4614" y="813.3267">(auto-refresh)</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg14"><polygon fill="#000000" points="747.7715,866.6548,757.7715,870.6548,747.7715,874.6548,751.7715,870.6548" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="581.9233" x2="753.7715" y1="870.6548" y2="870.6548"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="153.8481" x="588.9233" y="850.126">CREATE auth.users row</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51.124" x="588.9233" y="865.9253">(if new)</text></g><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg15"><line style="stroke:#000000;stroke-width:1;" x1="759.7715" x2="801.7715" y1="932.0527" y2="932.0527"/><line style="stroke:#000000;stroke-width:1;" x1="801.7715" x2="801.7715" y1="932.0527" y2="945.0527"/><line style="stroke:#000000;stroke-width:1;" x1="760.7715" x2="801.7715" y1="945.0527" y2="945.0527"/><polygon fill="#000000" points="770.7715,941.0527,760.7715,945.0527,770.7715,949.0527,766.7715,945.0527" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="183.9995" x="766.7715" y="895.7246">Trigger: handle_new_user()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.6665" x="766.7715" y="911.5239">auto-create profiles row</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="175.9824" x="766.7715" y="927.3232">generate unique username</text></g><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg16"><polygon fill="#000000" points="246.4614,970.8521,236.4614,974.8521,246.4614,978.8521,242.4614,974.8521" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="240.4614" x2="580.9233" y1="974.8521" y2="974.8521"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91.1079" x="252.4614" y="970.1226">Session token</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg17"><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="277.4614" y1="1004.6514" y2="1004.6514"/><line style="stroke:#000000;stroke-width:1;" x1="277.4614" x2="277.4614" y1="1004.6514" y2="1017.6514"/><line style="stroke:#000000;stroke-width:1;" x1="236.4614" x2="277.4614" y1="1017.6514" y2="1017.6514"/><polygon fill="#000000" points="246.4614,1013.6514,236.4614,1017.6514,246.4614,1021.6514,242.4614,1017.6514" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="145.5771" x="242.4614" y="999.9219">Store in AsyncStorage</text></g><path d="M15,1032.6514 L79.0493,1032.6514 L79.0493,1040.4507 L69.0493,1050.4507 L15,1050.4507 L15,1032.6514" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="154.5952" style="stroke:#000000;stroke-width:1;" width="787.812" x="15" y="1032.6514"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.0493" x="30" y="1046.7212">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70.2432" x="94.0493" y="1045.7104">[New user]</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg18"><polygon fill="#000000" points="54.9277,1084.0493,44.9277,1088.0493,54.9277,1092.0493,50.9277,1088.0493" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="48.9277" x2="234.4614" y1="1088.0493" y2="1088.0493"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107.0342" x="60.9277" y="1067.5205">Onboarding flow</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="134.8369" x="60.9277" y="1083.3198">(A/B tested screens)</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg19"><polygon fill="#000000" points="223.4614,1129.6479,233.4614,1133.6479,223.4614,1137.6479,227.4614,1133.6479" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="1133.6479" y2="1133.6479"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101.4292" x="50.9277" y="1113.1191">Name, country,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120.085" x="50.9277" y="1128.9185">birthday, interests</text></g><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg20"><polygon fill="#000000" points="747.7715,1175.2466,757.7715,1179.2466,747.7715,1183.2466,751.7715,1179.2466" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="753.7715" y1="1179.2466" y2="1179.2466"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.8188" x="242.4614" y="1158.7178">UPDATE profiles</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="200.2876" x="242.4614" y="1174.5171">SET onboarding_completed_at</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg21"><polygon fill="#000000" points="54.9277,1212.0459,44.9277,1216.0459,54.9277,1220.0459,50.9277,1216.0459" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="48.9277" x2="234.4614" y1="1216.0459" y2="1216.0459"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.0972" x="60.9277" y="1211.3164">Route to /(tabs)/home</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1208.6133" x="5" y="1244.9456"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1213.6133" y1="1244.9456" y2="1244.9456"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1213.6133" y1="1247.9456" y2="1247.9456"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="226.9893" x="495.812" y="1234.0459"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="208.5459" x="501.812" y="1251.1157">Direct Messaging (Realtime)</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg22"><polygon fill="#000000" points="223.4614,1285.6445,233.4614,1289.6445,223.4614,1293.6445,227.4614,1289.6445" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="1289.6445" y2="1289.6445"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="88.9941" x="50.9277" y="1284.915">Open dm/[id]</text></g><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg23"><polygon fill="#000000" points="747.7715,1331.2432,757.7715,1335.2432,747.7715,1339.2432,751.7715,1335.2432" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="753.7715" y1="1335.2432" y2="1335.2432"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173.6846" x="242.4614" y="1314.7144">SELECT * FROM messages</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="182.7363" x="242.4614" y="1330.5137">WHERE conversation_id = ?</text></g><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg24"><polygon fill="#000000" points="246.4614,1361.0425,236.4614,1365.0425,246.4614,1369.0425,242.4614,1365.0425" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="240.4614" x2="758.7715" y1="1365.0425" y2="1365.0425"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="105.2886" x="252.4614" y="1360.313">Message history</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg25"><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="277.4614" y1="1410.6411" y2="1410.6411"/><line style="stroke:#000000;stroke-width:1;" x1="277.4614" x2="277.4614" y1="1410.6411" y2="1423.6411"/><line style="stroke:#000000;stroke-width:1;" x1="236.4614" x2="277.4614" y1="1423.6411" y2="1423.6411"/><polygon fill="#000000" points="246.4614,1419.6411,236.4614,1423.6411,246.4614,1427.6411,242.4614,1423.6411" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131.7329" x="242.4614" y="1390.1123">Subscribe Supabase</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112.3789" x="242.4614" y="1405.9116">Realtime channel</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg26"><polygon fill="#000000" points="223.4614,1449.4404,233.4614,1453.4404,223.4614,1457.4404,227.4614,1453.4404" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="43.9277" x2="229.4614" y1="1453.4404" y2="1453.4404"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144.3267" x="50.9277" y="1448.7109">Type + send message</text></g><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg27"><polygon fill="#000000" points="747.7715,1479.2397,757.7715,1483.2397,747.7715,1487.2397,751.7715,1483.2397" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="753.7715" y1="1483.2397" y2="1483.2397"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.292" x="242.4614" y="1478.5103">INSERT INTO messages</text></g><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg28"><polygon fill="#000000" points="747.7715,1524.8384,757.7715,1528.8384,747.7715,1532.8384,751.7715,1528.8384" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="753.7715" y1="1528.8384" y2="1528.8384"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="147.0942" x="242.4614" y="1508.3096">UPDATE conversations</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.7529" x="242.4614" y="1524.1089">(last_message, timestamp)</text></g><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg29"><polygon fill="#000000" points="246.4614,1570.437,236.4614,1574.437,246.4614,1578.437,242.4614,1574.437" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="240.4614" x2="758.7715" y1="1574.437" y2="1574.437"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="125.728" x="252.4614" y="1553.9082">Realtime broadcast</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.4766" x="252.4614" y="1569.7075">to recipient's subscription</text></g><g class="message" data-entity-1="part5" data-entity-2="part6" id="msg30"><polygon fill="#000000" points="945.771,1600.2363,955.771,1604.2363,945.771,1608.2363,949.771,1604.2363" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="759.7715" x2="951.771" y1="1604.2363" y2="1604.2363"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.5239" x="766.7715" y="1599.5068">Webhook: INSERT trigger</text></g><g class="message" data-entity-1="part6" data-entity-2="part5" id="msg31"><polygon fill="#000000" points="770.7715,1661.6343,760.7715,1665.6343,770.7715,1669.6343,766.7715,1665.6343" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="764.7715" x2="956.771" y1="1665.6343" y2="1665.6343"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="121.1514" x="776.7715" y="1629.3062">Fetch participants,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89.2861" x="776.7715" y="1645.1055">filter blocked,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="108.5767" x="776.7715" y="1660.9048">get push_tokens</text></g><g class="message" data-entity-1="part6" data-entity-2="part7" id="msg32"><polygon fill="#000000" points="1143.2461,1707.2329,1153.2461,1711.2329,1143.2461,1715.2329,1147.2461,1711.2329" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="957.771" x2="1149.2461" y1="1711.2329" y2="1711.2329"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.8589" x="964.771" y="1690.7041">Send notification</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173.4751" x="964.771" y="1706.5034">{title: sender, body: text}</text></g><g class="message" data-entity-1="part7" data-entity-2="part1" id="msg33"><polygon fill="#000000" points="54.9277,1752.8315,44.9277,1756.8315,54.9277,1760.8315,50.9277,1756.8315" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="48.9277" x2="1154.2461" y1="1756.8315" y2="1756.8315"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107.9673" x="60.9277" y="1736.3027">Push notification</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.2715" x="60.9277" y="1752.1021">on recipient device</text></g><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg34"><line style="stroke:#000000;stroke-width:1;" x1="759.7715" x2="801.7715" y1="1786.6309" y2="1786.6309"/><line style="stroke:#000000;stroke-width:1;" x1="801.7715" x2="801.7715" y1="1786.6309" y2="1799.6309"/><line style="stroke:#000000;stroke-width:1;" x1="760.7715" x2="801.7715" y1="1799.6309" y2="1799.6309"/><polygon fill="#000000" points="770.7715,1795.6309,760.7715,1799.6309,770.7715,1803.6309,766.7715,1799.6309" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="171.0376" x="766.7715" y="1781.9014">INSERT INTO notifications</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg35"><line style="stroke:#000000;stroke-width:1;" x1="235.4614" x2="277.4614" y1="1876.8281" y2="1876.8281"/><line style="stroke:#000000;stroke-width:1;" x1="277.4614" x2="277.4614" y1="1876.8281" y2="1889.8281"/><line style="stroke:#000000;stroke-width:1;" x1="236.4614" x2="277.4614" y1="1889.8281" y2="1889.8281"/><polygon fill="#000000" points="246.4614,1885.8281,236.4614,1889.8281,246.4614,1893.8281,242.4614,1889.8281" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="139.9976" x="242.4614" y="1824.7007">useUnreadIndicator()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="140.4736" x="242.4614" y="1840.5">Realtime subscription</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="105.0981" x="242.4614" y="1856.2993">invalidate cache</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="103.6318" x="242.4614" y="1872.0986">show badge dot</text></g><?plantuml-src bLNRRkCs47tNLqppqDgjituFa1REHjari9iOlY0FTM5GubWY8WzLaRRNA0hq8_g5_PBEK1VBsRJ0FjaYpyoSENFXTpx77K9PA4DHv8ql41QsKF3FNt_3PEzp-1u-etCgCvJ10d_V8wKOHIhrjeALmoegLULDQaf57gxco3VmgBmvu9ecPNa5oW7_Ni8AauojOlVll0k89ubrYLdiIvKe9sxuhlOZ8AryE8UhcNK-gz2jQJ3_j1W6oFtTfPTOPmWFUqgziRIcSk_oQqlNkv0J1XE1l3BwKbgOCPHZpwO195zHT7iB2vCHh4eOr_-c1BUtKIHAmFNFaYdSm5E918gJbi_kz7sEwGjCt8dI1Ql7uTUqPHMTEg06nuoO8ajRi82s_Gw5-61jneMfHGAu3BPK9OibN0p1qN39QlWL8vlumP2XMRWGx9G6GxwlBtg83nt2q3lN0DUKeGUZb_O5gM_L6DMuPmuzhJ63DG6KbJqOZLKRTYI7NgvlMb_320ikvAjicVGt91lGR-IgvFp_KWs6yh_9CnJcd2mIJyCfq8IVWAoq_RUd7bYSCn_LZjxEEzufKtoLSKoUFr7kc4Ufd3lQIf_pxH5PbOCXs6fDPrQp1ZzeGdxaLcuxxRKBpdjHNuaA0nvFUrtXbWSiPslIKTGcVtydxJoF9yiOmXJlcRA3oXxPpco1y3YC6DH2bvN9Cf4ZLwGBtF3zHamaJWYJLgWyYcvRKs3ZAKF2IextP7ZlW5YGsc7BevEeOLrBV3bpCcWelT8VksR6y1XSddK8mlFqKc9LfMNXROkGqcHy1nwTbp5bgaXk-5MT7fdP25Ax9r-TkEA9gNokrMd4qRc2REtEaO8ggzcz2DWclQP5l0JR1T-aTiVDmq4toZVwN_2SspsBuosC1xmHtN2SMn67TzIzgP3Ny7bn3tWl5zxiSFXVsqhlnhyQ_LlK9xY8FyNlb_0ZFCoVFaEpCfddyyTu7dEgTE2gArci6wFX5du9DU_yrk4HSkDOzzEhmkmJbj8a_DnqUxub2Idt2M7nckZoL2BFW6CjMZONVAUFYtY-v9_bKySsUaFnFdDvF0hb_AOn684mS5xjoc7Kz70TlMENL5Rfb6tMnEApqgOql2r-uCcgaoh5SMCRtfyRUCOaj_Qbu-ZhYOZ2TKll0NsQG-ybSjn7t1ko09B2fY-eH_LwacTi4zhTTIxaXGh3mEgGzMPhKbK_Ud-4T_qc28VL21AhJpVSq5_ydr6mElTK-Boqvi7gSWID1oFlVs-u-whtBTrbmNdKLiHZhgUa1M73z7UYzgLRy-DpK8NHClofIdFk3PVR8oHASjNMH_y2?></g></svg>